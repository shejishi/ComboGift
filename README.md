>äº§å“éœ€æ±‚ï¼š
    1ã€ æœ‰æš´å‡»ï¼Œæš´å‡»çš„æ—¶é•¿ä¸º5ç§’
    2ã€ æœ‰æ•°æ®éœ€è¦æ— é™å¾€é‡Œé¢æ·»åŠ ï¼Œä¸»æ’­éœ€è¦å®æ—¶çœ‹åˆ°é€ç¤¼ç‰©çš„æƒ…å†µ
    3ã€ å½“ç¤¼ç‰©è¢«åé¢çš„æ•°æ®é¡¶ä¸Šå»æ—¶ï¼Œå¦‚æœæœ‰æš´å‡»ï¼Œé‡æ–°è¿›å…¥ï¼Œç„¶åå åŠ 
    3ã€å½“åŠ¨ç”»è¿›å…¥åæ‰æ˜¾ç¤ºåé¢çš„æ•°æ®`(æš‚æœªå®ç°)`

###### å®ç°æ•ˆæœï¼š
![ç¤¼ç‰©æš´å‡»æ•ˆæœ](https://upload-images.jianshu.io/upload_images/2158207-5974e4e3bc45c076.gif?imageMogr2/auto-orient/strip)

å¤§è‡´çš„æ•ˆæœå›¾å¦‚ä¸Šï¼Œä¸€èˆ¬ç›´æ’­é¡¹ç›®ä¸­ä½¿ç”¨çš„ç¤¼ç‰©æ¡†æ¶éƒ½æ˜¯ç±»ä¼¼çš„å®ç°æ–¹å¼ï¼Œä¸è¿‡æœ‰äº›åƒ `*çˆ±ç½‘`çš„åŠ¨ç”»æ˜¯æœ‰ä¸€ä¸ªé˜Ÿåˆ—çš„å½¢å¼ï¼Œè€Œä¸”æ²¡æœ‰æš´å‡»ï¼Œå½“ç”¨æˆ·èµ é€çš„ç¤¼ç‰©è¿‡å¤šæ—¶ï¼Œä¼šå‡ºç°ç¤¼ç‰©ä¸æ–­çš„å‡ºç°åœ¨ä¸Šé¢ï¼›è¿˜æœ‰åƒ`*é±¼ç›´æ’­App`å®ç°çš„æš´å‡»å’Œä¸Šé¢çš„ç±»ä¼¼ï¼Œä¸è¿‡å½“ç¤¼ç‰©æ¨ä¸Šå»ä¹‹åæ˜¯ä¸ä¼šé‡æ–°æš´å‡»çš„ï¼›æˆ‘ä»¬çš„äº§å“æš´å‡»æ—¶é—´æ¯”è¾ƒé•¿ï¼Œç›®å‰çš„å®ç°æ–¹å¼å‚è€ƒäº†å¸‚é¢ä¸Šå¤šä¸ª`APP`çš„å½¢å¼ã€‚

ä¸‹é¢ï¼Œæˆ‘ä»¬å¯¹è¯¥éœ€æ±‚è¿›è¡Œæ‹†åˆ†ï¼š

## ä¸€ã€å¯¹è±¡åˆ›å»º
ç®€å•çš„åˆ†æéœ€æ±‚åï¼Œæˆ‘ä»¬å¤§è‡´å¯ä»¥å°†è¯¥åŠ¨ç”»åˆ†ä¸ºä¸‰ä¸ªå¯¹è±¡ï¼š
```
1ã€ ç¤¼ç‰©ç®¡ç†ç±»ï¼Œ
    
2ã€ ç¤¼ç‰©å¸ƒå±€ç±»

3ã€ åŠ¨ç”»ç±»
```

##### ç¤¼ç‰©ç®¡ç†ç±»

è¯¥å¯¹è±¡ä¸­ï¼Œåº”è¯¥ä¿å­˜æ‰€æœ‰çš„ç¤¼ç‰©å¸ƒå±€å¯¹è±¡ï¼Œæ§åˆ¶å…¶æ·»åŠ ã€åˆ é™¤ï¼›

##### ç¤¼ç‰©å¸ƒå±€ç±»
å¸ƒå±€å½“ç„¶æ˜¯æ˜¾ç¤ºå½“å‰ç¤¼ç‰©çš„æ•°æ®ï¼šèµ é€äººçš„å¤´åƒã€åå­—ã€æ¥æ”¶äººçš„åå­—ã€ç¤¼ç‰©çš„å›¾ç‰‡ã€æš´å‡»çš„æ•°é‡ç­‰ï¼Œç¤¼ç‰©å¸ƒå±€è¿˜æœ‰ä¸€ä¸ªéšè—çš„åŠŸèƒ½æ˜¯è‡ªèº«çš„æš´å‡»æ—¶é—´å’Œéšè—çš„æ—¶é—´æ§åˆ¶ï¼›å½“ç„¶ï¼Œè¿™ä¸¤ä¸ªæ—¶é—´æ˜¯ä¸€æ ·çš„ï¼Œå½“æœ‰æš´å‡»çš„æ—¶å€™ï¼Œå–æ¶ˆéšè—çš„æ—¶é—´ï¼Œç„¶åæš´å‡»ç»“æŸååˆå¼€å§‹éšè—æ—¶é—´çš„å€’è®¡æ—¶ã€‚

##### åŠ¨ç”»ç±»
æ§åˆ¶å¸ƒå±€çš„æ˜¾ç¤ºã€éšè—ã€æš´å‡»çš„åŠ¨ç”»

## äºŒã€ ç¤¼ç‰©ç®¡ç† `GiftControl.java`

##### 2.1 æ·»åŠ åŠ¨æ€å‚æ•°

é¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ª`GiftControl`ï¼Œæ·»åŠ å¤§è‡´çš„æ¡†æ¶æ–¹æ³•ï¼Œä¸éœ€è¦è®¾ç½®ä¸ºå•ä¾‹ç±»ï¼Œå› ä¸ºå•ä¾‹å¼•ç”¨å¯èƒ½å¯¼è‡´ç•Œé¢çš„å†…å­˜æ³„æ¼ï¼Œæ‰€ä»¥æˆ‘ä»¬ç›´æ¥è®¾ç½®æ„é€ æ–¹æ³•ä¼ `Context`è¿›å…¥å³å¯ï¼š
```
public class GiftControl {
  public GiftControl(Context context) {
      mContext = context;
  }
}
```
ç„¶åï¼Œä½œä¸ºç¤¼ç‰©å¸ƒå±€çš„å­˜æ”¾ç®¡ç†è€…ï¼Œè¿˜éœ€è¦æœ‰ä¸€ä¸ªå¸ƒå±€å®¹å™¨æ¥æ·»åŠ ï¼Œæ‰€ä»¥ï¼Œè¿˜éœ€è¦ä»é¡µé¢ä¸­ä¼ å…¥ä¸€ä¸ª`ViewGroup`åˆ°é‡Œé¢ï¼Œå¸ƒå±€å®¹å™¨ä¸­è¿˜éœ€è¦æœ‰ä¸€ä¸ªç¤¼ç‰©çš„æ•°é‡ï¼Œæ¯”å¦‚æˆ‘ä¸Šé¢æœ€å¤§çš„æ˜¾ç¤ºæ•°é‡ä¸º2ï¼Œè¿™äº›éƒ½å¯ä»¥åŠ¨æ€æ§åˆ¶ï¼Œæ‰€ä»¥å¢åŠ ä¸€ä¸ªæ–¹æ³•è®¾ç½®è¿™ä¸¤ä¸ªå‚æ•°ï¼š
```
public class GiftControl {
  public GiftControl(Context context) {
      mContext = context;
  }

  /**
   * @param giftLayoutParent å­˜æ”¾ç¤¼ç‰©æ§ä»¶çš„çˆ¶å®¹å™¨
   * @param giftMaxNum       ç¤¼ç‰©æ§ä»¶çš„æ•°é‡
   * @return
   */
  public GiftControl setGiftLayout(LinearLayout giftLayoutParent, @NonNull int giftMaxNum) {
      if (giftMaxNum <= 0) {
          throw new IllegalArgumentException("GiftFrameLayoutæ•°é‡å¿…é¡»å¤§äº0");
      }
      if (giftLayoutParent.getChildCount() > 0) {
          //å¦‚æœçˆ¶å®¹å™¨æ²¡æœ‰å­å­©å­ï¼Œå°±è¿›è¡Œæ·»åŠ 
          return this;
      }
      mGiftLayoutParent = giftLayoutParent;
      mGiftLayoutMaxNums = giftMaxNum;
      LayoutTransition transition = new LayoutTransition();
      transition.setAnimator(LayoutTransition.CHANGE_APPEARING,
                transition.getAnimator(LayoutTransition.CHANGE_APPEARING));
      transition.setAnimator(LayoutTransition.APPEARING, 
                transition.getAnimator(LayoutTransition.APPEARING));
      transition.setAnimator(LayoutTransition.DISAPPEARING, 
                transition.getAnimator(LayoutTransition.CHANGE_APPEARING));
      transition.setAnimator(LayoutTransition.CHANGE_DISAPPEARING, 
                transition.getAnimator(LayoutTransition.DISAPPEARING));
      mGiftLayoutParent.setLayoutTransition(transition);
      return this;
  }
}
```

ä¸Šé¢ï¼Œæˆ‘ä»¬æ·»åŠ äº†ä¸¤ä¸ªå‚æ•°è®¾ç½®ï¼Œè¿˜ç»™å¸ƒå±€æ·»åŠ äº† `LayoutTransition`åŠ¨ç”»ï¼Œå…³äº`LayoutTransition`åŠ¨ç”»çš„ä½¿ç”¨ï¼Œå®˜ç½‘å¯¹å…¶è¿›è¡Œäº†è¯¦ç»†çš„è§£é‡Šä½¿ç”¨ï¼š
[https://developer.android.com/reference/android/animation/LayoutTransition](https://developer.android.com/reference/android/animation/LayoutTransition)

##### 2.2 æ·»åŠ ç¤¼ç‰©æ•°æ®ã€æ˜¾ç¤ºç¤¼ç‰©å¸ƒå±€
æ·»åŠ ç¤¼ç‰©
```
public class GiftControl {
  public GiftControl(Context context) {
      mContext = context;
  }

  /**
   * @param giftLayoutParent å­˜æ”¾ç¤¼ç‰©æ§ä»¶çš„çˆ¶å®¹å™¨
   * @param giftMaxNum       ç¤¼ç‰©æ§ä»¶çš„æ•°é‡
   * @return
   */
  public GiftControl setGiftLayout(LinearLayout giftLayoutParent, @NonNull int giftMaxNum) {
      if (giftMaxNum <= 0) {
          throw new IllegalArgumentException("GiftFrameLayoutæ•°é‡å¿…é¡»å¤§äº0");
      }
      if (giftLayoutParent.getChildCount() > 0) {
          //å¦‚æœçˆ¶å®¹å™¨æ²¡æœ‰å­å­©å­ï¼Œå°±è¿›è¡Œæ·»åŠ 
          return this;
      }
      mGiftLayoutParent = giftLayoutParent;
      mGiftLayoutMaxNums = giftMaxNum;
      LayoutTransition transition = new LayoutTransition();
      transition.setAnimator(LayoutTransition.CHANGE_APPEARING,
                transition.getAnimator(LayoutTransition.CHANGE_APPEARING));
      transition.setAnimator(LayoutTransition.APPEARING, 
                transition.getAnimator(LayoutTransition.APPEARING));
      transition.setAnimator(LayoutTransition.DISAPPEARING, 
                transition.getAnimator(LayoutTransition.CHANGE_APPEARING));
      transition.setAnimator(LayoutTransition.CHANGE_DISAPPEARING, 
                transition.getAnimator(LayoutTransition.DISAPPEARING));
      mGiftLayoutParent.setLayoutTransition(transition);
      return this;
  }
  
  /**
   * æ·»åŠ ç¤¼ç‰©æ•°æ®
   */
  public synchronized void loadGift(LiveGiftBean gift) {
      showGift(gift);
  }

    private synchronized void showGift(LiveGiftBean giftBean) {
        if (giftBean == null) {
            return;
        }
        LiveGiftLayout giftLayout;
        int childCount = mGiftLayoutParent.getChildCount();
        Log.d(TAG, "showGift: ç¤¼ç‰©å¸ƒå±€çš„ä¸ªæ•°" + childCount);
       
        //æ²¡æœ‰è¶…è¿‡æœ€å¤§çš„ç¤¼ç‰©å¸ƒå±€æ•°é‡ï¼Œå¯ä»¥ç»§ç»­æ·»åŠ ç¤¼ç‰©å¸ƒå±€
        giftLayout = new LiveGiftLayout(mContext);
        giftLayout.setIndex(0);
        //ä¸¤ä¸ªå‚æ•°åˆ†åˆ«æ˜¯layout_width,layout_height
        RelativeLayout.LayoutParams lp = (RelativeLayout.LayoutParams) mGiftLayoutParent.getLayoutParams();
        //è¿™ä¸ªå°±æ˜¯æ·»åŠ å…¶ä»–å±æ€§çš„ï¼Œè¿™ä¸ªæ˜¯åœ¨çˆ¶å…ƒç´ çš„åº•éƒ¨ã€‚
        lp.addRule(RelativeLayout.ALIGN_PARENT_BOTTOM);
        mGiftLayoutParent.addView(giftLayout);
        boolean hasGift = giftLayout.setGift(giftBean);
        if (hasGift) {
            giftLayout.startAnimation(customAnim);
            // æ·»åŠ åˆ°viewé˜Ÿåˆ—ä¸­
            mLiveGiftLayouts.add(giftLayout);
        }
    }
}
```
æ·»åŠ æ•°æ®ï¼Œç›´æ¥è°ƒç”¨æ˜¾ç¤ºæ•°æ®çš„æ–¹æ³•ï¼Œåœ¨é‡Œé¢ï¼Œæˆ‘ä»¬æ–°å»ºå¸ƒå±€ç±»ï¼Œç„¶åå¤–å±‚æ˜¯ä¸€ä¸ª`RelativeLayout`å°†å…¶è§„åˆ™è®¾ç½®ä¸ºåº•éƒ¨ï¼Œå› ä¸ºä¸Šé¢æ˜¯è‡ªåº•å‘ä¸ŠåŠ¨ç”»ï¼›

å¥½äº†ï¼ŒåŠ¨ç”»ç®¡ç†ç±»ï¼Œç®€å•çš„æ¡†æ¶å°±æ˜¯è¿™æ ·ï¼Œåé¢å°±åªéœ€è¦å¾€æ–¹æ³•ä¸Šå åŠ é€»è¾‘å°±å¥½äº†ã€‚

## ä¸‰ã€ åŠ¨ç”»å¸ƒå±€ç±» `LiveGiftLayout.java`
å¸ƒå±€ç±»æ˜¯ä¸€ä¸ªè‡ªå®šä¹‰çš„ç»„åˆ`View`,å¸ƒå±€æ˜¯æ¯”è¾ƒç®€å•çš„ï¼Œæ ¹æ®åˆ›å»ºè‡ªå®šä¹‰`View`çš„æ–¹å¼æ¥å³å¯ï¼š
```
public class LiveGiftLayout extends FrameLayout {
    private LayoutInflater mInflater;
    private Context mContext;

    RelativeLayout mGiftItemContent;
    ImageView mIvGift, mIvSenderHeader;
    TextView mTvSenderName, mTvSenderInfo;
    TextView mTvGiftNum;

    private View rootView;

    public LiveGiftLayout(Context context) {
        this(context, null);
    }

    public LiveGiftLayout(Context context, AttributeSet attrs) {
        this(context, attrs, 0);
    }

    public LiveGiftLayout(Context context, AttributeSet attributeSet, @AttrRes int defStyleAttr) {
        super(context, attributeSet, defStyleAttr);

        mInflater = LayoutInflater.from(context);
        mContext = context;
        initView();
    }

    private void initView() {
        rootView = mInflater.inflate(R.layout.item_live_voice_gift, null);
        mGiftItemContent = rootView.findViewById(R.id.item_live_voice_gift_content);
        mIvGift = rootView.findViewById(R.id.item_live_voice_gift_iv_gift);
        mTvGiftNum = rootView.findViewById(R.id.item_live_voice_gift_tv_num);
        mIvSenderHeader = rootView.findViewById(R.id.item_live_voice_gift_iv_header);
        mTvSenderName = rootView.findViewById(R.id.item_live_voice_gift_tv_nickname);
        mTvSenderInfo = rootView.findViewById(R.id.item_live_voice_gift_tv_info);

        this.addView(rootView);
    }

    public boolean setGift(LiveGiftBean gift) {
        if (gift == null) {
            return false;
        }
        mGift = gift;

        if (mGift.isCurrentStart()) {
            mGiftCount = gift.getGiftCount() + mGift.getHitCombo();
        } else {
            mGiftCount = gift.getGiftCount();
        }
        if (!TextUtils.isEmpty(gift.getSendUserName())) {
            mTvSenderName.setText(gift.getSendUserName());
        }
        if (!TextUtils.isEmpty(gift.getGiftId())) {
            mTvSenderInfo.setText(gift.getGiftName());
        }
        // è®¾ç½®å¤´åƒ
        mIvSenderHeader.setImageDrawable(ContextCompat.getDrawable(mContext, gift.getSendUserPic()));
        // è®¾ç½®åå­—
        String firstText = "é€ ";
        String beforeColor = "#2d2d2d";
        String afterColor = "#ff3a72";

        //åˆ›å»ºSpannableStringBuilderï¼Œå¹¶æ·»åŠ å‰é¢æ–‡æ¡ˆ
        SpannableStringBuilder builder = new SpannableStringBuilder(firstText);
        //è®¾ç½®å‰é¢çš„å­—ä½“é¢œè‰²
        builder.setSpan(new ForegroundColorSpan(Color.parseColor(beforeColor)), 0, firstText.length(), Spannable.SPAN_EXCLUSIVE_INCLUSIVE);
        //è¿½åŠ åé¢æ–‡æ¡ˆ
        builder.append(gift.getRecevierUserName());
        //è®¾ç½®åé¢çš„å­—ä½“é¢œè‰²
        builder.setSpan(new ForegroundColorSpan(Color.parseColor(afterColor)), firstText.length(), builder.length(), Spannable.SPAN_EXCLUSIVE_INCLUSIVE);
        mTvSenderInfo.setText(builder);

        // è®¾ç½®ç¤¼ç‰©å›¾ç‰‡
        mIvGift.setImageDrawable(ContextCompat.getDrawable(mContext, gift.getGiftPic()));

        mTvGiftNum.setText("x " + (mGiftCount));
        mCombo = mGiftCount;
        return true;
    }
}
```
ä¸Šé¢ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ä¸€ä¸ªè‡ªå®šä¹‰ç»„åˆ`View`ï¼Œå› ä¸ºåœ¨`GiftControl`ä¸­æ˜¾ç¤º`layout`çš„æ—¶å€™ï¼Œè°ƒç”¨äº†`setGift()`æ–¹æ³•ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨é‡Œé¢åˆ›å»ºè¿™ä¸ªæ–¹æ³•ï¼Œç›®çš„æ˜¯è®¾ç½®é‡Œé¢æ§ä»¶æ•°æ®ã€‚

åˆ°ç°åœ¨ï¼Œæˆ‘ä»¬å¯ä»¥æ·»åŠ æ•°æ®åˆ°æ§åˆ¶ç±»ä¸­ï¼Œç„¶åæ˜¾ç¤ºæ•°æ®åˆ°`ViewGroup`ä¸­ï¼Œå›¾ç‰‡çš„è¯ï¼Œè‡ªå·±è„‘è¡¥ä¸€ä¸‹å§ğŸ˜Š

ä¸Šç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä»¬åˆ›å»ºäº†ç¤¼ç‰©åŠ¨ç”»ç±»ï¼Œå…¶ä¸­çš„åŠŸèƒ½ä¸ºï¼š
> 1ã€æ·»åŠ ç¤¼ç‰©
2ã€ æ·»åŠ ç¤¼ç‰©å¸ƒå±€ç±»ï¼Œ
3ã€æ˜¾ç¤ºç¤¼ç‰©å¸ƒå±€

ç¤¼ç‰©å¸ƒå±€ï¼Œå®ƒçš„ä½œç”¨ä¸ºï¼š
> 1ã€åˆ›å»ºå¸ƒå±€åæ˜¾ç¤ºå…¶ä¸­çš„æ•°æ®

ä»Šå¤©çš„æ–‡ç« ä¸»è¦æ˜¯å®Œå–„ä¸Šé¢çš„ç±»çš„åŠŸèƒ½ï¼š
```
1ã€æš´å‡»
2ã€æ— é™æ•°æ®æ·»åŠ 
3ã€ç¤¼ç‰©é¢æ¿è¢«é¡¶ä¸Šå»ä¹‹åï¼Œåœ¨æš´å‡»æ—¶é—´å†…éœ€è¦é‡æ–°å›åˆ°æš´å‡»é¢æ¿ä¸­
```

åœ¨å‰ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œ`GiftControl`ç±»ä¸­ï¼Œæ·»åŠ ç¤¼ç‰©åï¼Œå¼€å§‹äº†ä¸€ä¸ªè¿›å…¥ç¤¼ç‰©é¢æ¿çš„åŠ¨ç”»ï¼š
```
  public AnimatorSet startAnimation(IBaseAnim anim) {
    this.anim = anim;
        hideView();
        //å¸ƒå±€é£å…¥
        ObjectAnimator flyFromLtoR = LiveGiftAnimationUtil.createFlyFromLtoR(mGiftItemContent, -getWidth(), 0, 400L, new OvershootInterpolator());
        flyFromLtoR.addListener(new AnimatorListenerAdapter() {
            @Override
            public void onAnimationStart(Animator animation) {
                super.onAnimationStart(animation);
            }
        });
        //ç¤¼ç‰©é£å…¥
        ObjectAnimator flyFromLtoR2 = LiveGiftAnimationUtil.createFlyFromLtoR(mIvGift, -getWidth(), 0, 500L, new DecelerateInterpolator());
        flyFromLtoR2.addListener(new AnimatorListenerAdapter() {
            @Override
            public void onAnimationStart(Animator animation) {
                mIvGift.setVisibility(View.VISIBLE);
            }
            @Override
            public void onAnimationEnd(Animator animation) {
                comboAnimation(true);
            }
        });
        return LiveGiftAnimationUtil.startAnimation(flyFromLtoR, flyFromLtoR2);
    }
```

ä»è¿™é‡Œå¼€å§‹ï¼ŒåŠ¨ç”»ç»“æŸåï¼Œå°±æœ‰ä¸€ä¸ªæš´å‡»å€’è®¡æ—¶ï¼Œè¿™ä¸ªæˆ‘ä»¬æœ‰å¤šç§å®ç°æ–¹å¼ï¼Œè¿™é‡Œæˆ‘ä»¬ä½¿ç”¨`Handler`å®ç°ï¼š
```

private Handler mHandler = new Handler(this);  // è¿å‡»hander
private Runnable mCurrentAnimRunnable;  // è¿å‡»æ£€æµ‹runnable

/**
 * è¿å‡»ç»“æŸæ—¶å›è°ƒ
 */
public void comboEndAnim() {
    if (mHandler != null) {
        if (mCurrentAnimRunnable == null) {
            mCurrentAnimRunnable = new GiftNumAnimaRunnable();
            mHandler.postDelayed(mCurrentAnimRunnable, GIFT_DISMISS_TIME);
        }
    }
}

// åŠ¨ç”»è¿æ¥runnable
private class GiftNumAnimaRunnable implements Runnable {
    @Override
    public void run() {
        dismissGiftLayout();
    }
}
```

ä¸Šé¢ï¼Œå½“è¿å‡»ç»“æŸä¹‹åï¼Œå°±ä½¿ç”¨`Handler`å¼€å§‹`postDelayed`ä¸€ä¸ªå»¶æ—¶çš„æ–¹æ³•æ¥æ˜¾ç¤ºç¤¼ç‰©æ¶ˆæ¯ã€‚åœ¨è¿™æœŸé—´ï¼Œå¦‚æœæœ‰æ–°çš„ç¤¼ç‰©è¿›æ¥ï¼Œå°±åˆ¤æ–­å½“å‰æ˜¯å¦åœ¨æ˜¾ç¤ºï¼Œæ‰€ä»¥éœ€è¦åœ¨`GiftControl`çš„`loadGift()`æ–¹æ³•ä¸­å®Œå–„ï¼š
```

// ä¿å­˜ç¤¼ç‰©view
private LinkedList<LiveGiftLayout> mLiveGiftLayouts;
/**
 * åŠ å…¥ç¤¼ç‰©ï¼Œå…·æœ‰å®æ—¶è¿å‡»æ•ˆæœ
 *
 * @param gift
 * @param supportCombo æ˜¯å¦æ”¯æŒå®æ—¶è¿å‡»ï¼Œå¦‚æœä¸ºtrueï¼šæ”¯æŒï¼Œå¦åˆ™ä¸æ”¯æŒ
 */
public synchronized void loadGift(LiveGiftBean gift, boolean supportCombo, 
                                boolean isFirst) {
       Iterator<LiveGiftLayout> liveGiftLayoutIterator 
                        = mLiveGiftLayouts.iterator();
        while (liveGiftLayoutIterator.hasNext()) {
            // è·å–åˆ°é˜Ÿåˆ—ä¸­çš„view
            LiveGiftLayout giftLayout = liveGiftLayoutIterator.next();
            // åˆ¤æ–­æ˜¯å¦åœ¨ä¹‹å‰å­˜åœ¨
            if (giftLayout.getCurrentGiftId().equals(gift.getGiftId()) && 
                  giftLayout.getCurrentSendUserId().equals(gift.getSendUserId())) {
                if (giftLayout.isRemove()) {
                    // å»æ‰ æ¶ˆå¤±çš„å›è°ƒ  æ•´æ¡æ•°æ®æ˜¯æ²¡ç”¨çš„äº†
                    giftLayout.removeDismissGiftCallback();
                    // è¢«é¡¶å‡ºå»äº†
                    liveGiftLayoutIterator.remove();
                    gift.setGiftCount(giftLayout.getGiftCount() + 1);
                    showGift(gift);
                } else {
                    //è¿å‡»
                    giftLayout.updateGiftCount(gift.getGiftCount());
                    giftLayout.setSendGiftTime(gift.getSendGiftTime());
                }
                return;
            }
        }
        showGift(gift);
    }
}
```

ä¸Šé¢çš„æ³¨é‡Šï¼Œé¦–å…ˆï¼Œæˆ‘ä»¬éœ€è¦æœ‰ä¸€ä¸ª `mLiveGiftLayouts`å˜é‡æ¥ä¿å­˜æ‰€æœ‰æ·»åŠ è¿›çš„çš„`layout`ï¼Œæ·»åŠ è¿›æ¥ä¹‹åï¼Œåœ¨ä¸‹ä¸€æ¬¡åŠ å…¥æ–°çš„æ•°æ®å°±éå†å…¶ä¸­æ‰€æœ‰çš„æ•°æ®ï¼Œç„¶åæ¥åˆ¤æ–­æ˜¯å¦å¯ä»¥æš´å‡»ï¼Œå¦‚æœæ˜¯æš´å‡»çš„è¯ï¼Œå°±æŠŠæ•°é‡ç»™ç´¯åŠ è¿›å…¥ç„¶åé‡æ–°è®¾ç½®å€¼ï¼›

åœ¨æš´å‡»çš„æ—¶å€™ï¼Œéœ€è¦ç§»é™¤æ‰`handler`çš„`GiftNumAnimaRunnable`ï¼Œä¸ç„¶åœ¨`GIFT_DISMISS_TIME`ä¹‹åï¼Œå°±ä¼šè‡ªåŠ¨ç§»é™¤ï¼Œæ‰€ä»¥æ¯æ¬¡æš´å‡»å¼€å§‹å°±è¦ç§»é™¤æ‰æ¶ˆå¤±çš„`runnable`ï¼Œåœ¨æš´å‡»åŠ¨ç”»ï¼ˆæ•°ç»„å˜å¤§çš„åŠ¨ç”»ï¼‰ç»“æŸåï¼Œé‡æ–°å¼€å§‹å€’è®¡æ—¶ï¼
```
/**
 * å¢åŠ ç¤¼ç‰©æ•°é‡,ç”¨äºè¿å‡»æ•ˆæœ
 *
 * @param count
 */
public synchronized void setGiftCount(int count) {
    mGiftCount += count;
    mGift.setGiftCount(mGiftCount);
    ++mCombo;
    mTvGiftNum.setText("x " + (mCombo));
    comboAnimation(false);
    removeDismissGiftCallback();
}

public void comboAnimation(boolean isFirst) {
  if (isFirst) {
    mTvGiftNum.setVisibility(View.VISIBLE);
    mTvGiftNum.setText("x " + mCombo);
    Log.d(TAG, "comboAnimation è¿å‡»ï¼š" + mCombo);
    comboEndAnim();
  } else {
    //æ•°é‡å¢åŠ 
    ObjectAnimator scaleGiftNum = LiveGiftAnimationUtil.scaleGiftNum(mTvGiftNum);
    scaleGiftNum.addListener(new AnimatorListenerAdapter() {
        @Override
        public void onAnimationStart(Animator animation) {
        }
        @Override
        public void onAnimationEnd(Animator animation) {
            comboEndAnim();
        }
    });
    scaleGiftNum.start();
  }
}
```
ä¸æ˜¯ç¬¬ä¸€æ¬¡å°±èµ°äº†ä¸‹é¢çš„é€»è¾‘ï¼Œæ•°å­—å˜å¤§çš„åŠ¨ç”»ç»“æŸä¹‹åï¼Œå›è°ƒåˆ°äº†æš´å‡»åŠ¨ç”»ç»“æŸçš„æ–¹æ³•ï¼›

åˆ°æ­¤ï¼Œä¸»è¦çš„é€»è¾‘å°±å†™å®Œäº†ï¼Œè¿˜æ˜¯å¾ˆç®€å•çš„ã€‚

ä»£ç ä¸Šä¼ åˆ°äº†[https://github.com/shejishi/ComboGift](https://github.com/shejishi/ComboGift)å–œæ¬¢çš„ç»™ä¸ªStarâ¤~





















